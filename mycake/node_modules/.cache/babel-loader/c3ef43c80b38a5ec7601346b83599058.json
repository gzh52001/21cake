{"ast":null,"code":"import _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _createClass from 'babel-runtime/helpers/createClass';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _inherits from 'babel-runtime/helpers/inherits';\n/* tslint:disable:no-bitwise */\n\nimport classnames from 'classnames';\nimport * as React from 'react';\nimport TouchFeedback from 'rmc-feedback';\nimport Flex from '../flex';\n\nfunction noop() {}\n\nvar ImagePicker = function (_React$Component) {\n  _inherits(ImagePicker, _React$Component);\n\n  function ImagePicker() {\n    _classCallCheck(this, ImagePicker); // http://stackoverflow.com/questions/7584794/accessing-jpeg-exif-rotation-data-in-javascript-on-the-client-side\n\n\n    var _this = _possibleConstructorReturn(this, (ImagePicker.__proto__ || Object.getPrototypeOf(ImagePicker)).apply(this, arguments));\n\n    _this.getOrientation = function (file, callback) {\n      var reader = new FileReader();\n\n      reader.onload = function (e) {\n        var view = new DataView(e.target.result);\n\n        if (view.getUint16(0, false) !== 0xffd8) {\n          return callback(-2);\n        }\n\n        var length = view.byteLength;\n        var offset = 2;\n\n        while (offset < length) {\n          var marker = view.getUint16(offset, false);\n          offset += 2;\n\n          if (marker === 0xffe1) {\n            var tmp = view.getUint32(offset += 2, false);\n\n            if (tmp !== 0x45786966) {\n              return callback(-1);\n            }\n\n            var little = view.getUint16(offset += 6, false) === 0x4949;\n            offset += view.getUint32(offset + 4, little);\n            var tags = view.getUint16(offset, little);\n            offset += 2;\n\n            for (var i = 0; i < tags; i++) {\n              if (view.getUint16(offset + i * 12, little) === 0x0112) {\n                return callback(view.getUint16(offset + i * 12 + 8, little));\n              }\n            }\n          } else if ((marker & 0xff00) !== 0xff00) {\n            break;\n          } else {\n            offset += view.getUint16(offset, false);\n          }\n        }\n\n        return callback(-1);\n      };\n\n      reader.readAsArrayBuffer(file.slice(0, 64 * 1024));\n    };\n\n    _this.getRotation = function () {\n      var orientation = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;\n      var imgRotation = 0;\n\n      switch (orientation) {\n        case 3:\n          imgRotation = 180;\n          break;\n\n        case 6:\n          imgRotation = 90;\n          break;\n\n        case 8:\n          imgRotation = 270;\n          break;\n\n        default:\n      }\n\n      return imgRotation;\n    };\n\n    _this.removeImage = function (index) {\n      var newImages = [];\n      var _this$props$files = _this.props.files,\n          files = _this$props$files === undefined ? [] : _this$props$files;\n      files.forEach(function (image, idx) {\n        if (index !== idx) {\n          newImages.push(image);\n        }\n      });\n\n      if (_this.props.onChange) {\n        _this.props.onChange(newImages, 'remove', index);\n      }\n    };\n\n    _this.addImage = function (imgItem) {\n      var _this$props$files2 = _this.props.files,\n          files = _this$props$files2 === undefined ? [] : _this$props$files2;\n      var newImages = files.concat(imgItem);\n\n      if (_this.props.onChange) {\n        _this.props.onChange(newImages, 'add');\n      }\n    };\n\n    _this.onImageClick = function (index) {\n      if (_this.props.onImageClick) {\n        _this.props.onImageClick(index, _this.props.files);\n      }\n    };\n\n    _this.onFileChange = function () {\n      var fileSelectorEl = _this.fileSelectorInput;\n\n      if (fileSelectorEl && fileSelectorEl.files && fileSelectorEl.files.length) {\n        var files = fileSelectorEl.files;\n        var imageParsePromiseList = [];\n\n        for (var i = 0; i < files.length; i++) {\n          imageParsePromiseList.push(_this.parseFile(files[i], i));\n        }\n\n        Promise.all(imageParsePromiseList).then(function (imageItems) {\n          return _this.addImage(imageItems);\n        })['catch'](function (error) {\n          if (_this.props.onFail) {\n            _this.props.onFail(error);\n          }\n        });\n      }\n\n      if (fileSelectorEl) {\n        fileSelectorEl.value = '';\n      }\n    };\n\n    _this.parseFile = function (file, index) {\n      return new Promise(function (resolve, reject) {\n        var reader = new FileReader();\n\n        reader.onload = function (e) {\n          var dataURL = e.target.result;\n\n          if (!dataURL) {\n            reject('Fail to get the ' + index + ' image');\n            return;\n          }\n\n          var orientation = 1;\n\n          _this.getOrientation(file, function (res) {\n            // -2: not jpeg , -1: not defined\n            if (res > 0) {\n              orientation = res;\n            }\n\n            resolve({\n              url: dataURL,\n              orientation: orientation,\n              file: file\n            });\n          });\n        };\n\n        reader.readAsDataURL(file);\n      });\n    };\n\n    return _this;\n  }\n\n  _createClass(ImagePicker, [{\n    key: 'render',\n    value: function render() {\n      var _this2 = this;\n\n      var _props = this.props,\n          prefixCls = _props.prefixCls,\n          style = _props.style,\n          className = _props.className,\n          _props$files = _props.files,\n          files = _props$files === undefined ? [] : _props$files,\n          selectable = _props.selectable,\n          onAddImageClick = _props.onAddImageClick,\n          multiple = _props.multiple,\n          accept = _props.accept,\n          capture = _props.capture,\n          disableDelete = _props.disableDelete;\n      var imgItemList = [];\n      var count = parseInt('' + this.props.length, 10);\n\n      if (count <= 0) {\n        count = 4;\n      }\n\n      var wrapCls = classnames('' + prefixCls, className);\n      files.forEach(function (image, index) {\n        var imgStyle = {\n          backgroundImage: 'url(\"' + image.url + '\")',\n          transform: 'rotate(' + _this2.getRotation(image.orientation) + 'deg)'\n        };\n        var itemStyle = {};\n        imgItemList.push(React.createElement(Flex.Item, {\n          key: 'item-' + index,\n          style: itemStyle\n        }, React.createElement('div', {\n          key: index,\n          className: prefixCls + '-item'\n        }, !disableDelete && React.createElement('div', {\n          className: prefixCls + '-item-remove',\n          role: 'button',\n          'aria-label': 'Click and Remove this image' // tslint:disable-next-line:jsx-no-multiline-js\n          ,\n          onClick: function onClick() {\n            _this2.removeImage(index);\n          }\n        }), React.createElement('div', {\n          className: prefixCls + '-item-content',\n          role: 'button',\n          'aria-label': 'Image can be clicked' // tslint:disable-next-line:jsx-no-multiline-js\n          ,\n          onClick: function onClick() {\n            _this2.onImageClick(index);\n          },\n          style: imgStyle\n        }))));\n      });\n      var selectEl = React.createElement(Flex.Item, {\n        key: 'select'\n      }, React.createElement(TouchFeedback, {\n        activeClassName: prefixCls + '-upload-btn-active'\n      }, React.createElement('div', {\n        className: prefixCls + '-item ' + prefixCls + '-upload-btn',\n        onClick: onAddImageClick,\n        role: 'button',\n        'aria-label': 'Choose and add image'\n      }, React.createElement('input', {\n        ref: function ref(input) {\n          if (input) {\n            _this2.fileSelectorInput = input;\n          }\n        },\n        type: 'file',\n        accept: accept // tslint:disable-next-line:jsx-no-multiline-js\n        ,\n        onChange: function onChange() {\n          _this2.onFileChange();\n        },\n        multiple: multiple,\n        capture: capture\n      }))));\n      var allEl = selectable ? imgItemList.concat([selectEl]) : imgItemList;\n      var length = allEl.length;\n\n      if (length !== 0 && length % count !== 0) {\n        var blankCount = count - length % count;\n        var fillBlankEl = [];\n\n        for (var i = 0; i < blankCount; i++) {\n          fillBlankEl.push(React.createElement(Flex.Item, {\n            key: 'blank-' + i\n          }));\n        }\n\n        allEl = allEl.concat(fillBlankEl);\n      }\n\n      var flexEl = [];\n\n      for (var _i = 0; _i < allEl.length / count; _i++) {\n        var rowEl = allEl.slice(_i * count, _i * count + count);\n        flexEl.push(rowEl);\n      }\n\n      var renderEl = flexEl.map(function (item, index) {\n        return React.createElement(Flex, {\n          key: 'flex-' + index\n        }, item);\n      });\n      return React.createElement('div', {\n        className: wrapCls,\n        style: style\n      }, React.createElement('div', {\n        className: prefixCls + '-list',\n        role: 'group'\n      }, renderEl));\n    }\n  }]);\n\n  return ImagePicker;\n}(React.Component);\n\nexport default ImagePicker;\nImagePicker.defaultProps = {\n  prefixCls: 'am-image-picker',\n  files: [],\n  onChange: noop,\n  onImageClick: noop,\n  onAddImageClick: noop,\n  onFail: noop,\n  selectable: true,\n  multiple: false,\n  accept: 'image/*',\n  length: 4,\n  disableDelete: false\n};","map":{"version":3,"sources":["F:/1111111111/demo2/线下三阶段/三阶段小组项目/react/21cake/mycake/node_modules/antd-mobile/es/image-picker/index.js"],"names":["_classCallCheck","_createClass","_possibleConstructorReturn","_inherits","classnames","React","TouchFeedback","Flex","noop","ImagePicker","_React$Component","_this","__proto__","Object","getPrototypeOf","apply","arguments","getOrientation","file","callback","reader","FileReader","onload","e","view","DataView","target","result","getUint16","length","byteLength","offset","marker","tmp","getUint32","little","tags","i","readAsArrayBuffer","slice","getRotation","orientation","undefined","imgRotation","removeImage","index","newImages","_this$props$files","props","files","forEach","image","idx","push","onChange","addImage","imgItem","_this$props$files2","concat","onImageClick","onFileChange","fileSelectorEl","fileSelectorInput","imageParsePromiseList","parseFile","Promise","all","then","imageItems","error","onFail","value","resolve","reject","dataURL","res","url","readAsDataURL","key","render","_this2","_props","prefixCls","style","className","_props$files","selectable","onAddImageClick","multiple","accept","capture","disableDelete","imgItemList","count","parseInt","wrapCls","imgStyle","backgroundImage","transform","itemStyle","createElement","Item","role","onClick","selectEl","activeClassName","ref","input","type","allEl","blankCount","fillBlankEl","flexEl","_i","rowEl","renderEl","map","item","Component","defaultProps"],"mappings":"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","sourcesContent":["import _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _createClass from 'babel-runtime/helpers/createClass';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _inherits from 'babel-runtime/helpers/inherits';\n/* tslint:disable:no-bitwise */\nimport classnames from 'classnames';\nimport * as React from 'react';\nimport TouchFeedback from 'rmc-feedback';\nimport Flex from '../flex';\nfunction noop() {}\n\nvar ImagePicker = function (_React$Component) {\n    _inherits(ImagePicker, _React$Component);\n\n    function ImagePicker() {\n        _classCallCheck(this, ImagePicker);\n\n        // http://stackoverflow.com/questions/7584794/accessing-jpeg-exif-rotation-data-in-javascript-on-the-client-side\n        var _this = _possibleConstructorReturn(this, (ImagePicker.__proto__ || Object.getPrototypeOf(ImagePicker)).apply(this, arguments));\n\n        _this.getOrientation = function (file, callback) {\n            var reader = new FileReader();\n            reader.onload = function (e) {\n                var view = new DataView(e.target.result);\n                if (view.getUint16(0, false) !== 0xffd8) {\n                    return callback(-2);\n                }\n                var length = view.byteLength;\n                var offset = 2;\n                while (offset < length) {\n                    var marker = view.getUint16(offset, false);\n                    offset += 2;\n                    if (marker === 0xffe1) {\n                        var tmp = view.getUint32(offset += 2, false);\n                        if (tmp !== 0x45786966) {\n                            return callback(-1);\n                        }\n                        var little = view.getUint16(offset += 6, false) === 0x4949;\n                        offset += view.getUint32(offset + 4, little);\n                        var tags = view.getUint16(offset, little);\n                        offset += 2;\n                        for (var i = 0; i < tags; i++) {\n                            if (view.getUint16(offset + i * 12, little) === 0x0112) {\n                                return callback(view.getUint16(offset + i * 12 + 8, little));\n                            }\n                        }\n                    } else if ((marker & 0xff00) !== 0xff00) {\n                        break;\n                    } else {\n                        offset += view.getUint16(offset, false);\n                    }\n                }\n                return callback(-1);\n            };\n            reader.readAsArrayBuffer(file.slice(0, 64 * 1024));\n        };\n        _this.getRotation = function () {\n            var orientation = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;\n\n            var imgRotation = 0;\n            switch (orientation) {\n                case 3:\n                    imgRotation = 180;\n                    break;\n                case 6:\n                    imgRotation = 90;\n                    break;\n                case 8:\n                    imgRotation = 270;\n                    break;\n                default:\n            }\n            return imgRotation;\n        };\n        _this.removeImage = function (index) {\n            var newImages = [];\n            var _this$props$files = _this.props.files,\n                files = _this$props$files === undefined ? [] : _this$props$files;\n\n            files.forEach(function (image, idx) {\n                if (index !== idx) {\n                    newImages.push(image);\n                }\n            });\n            if (_this.props.onChange) {\n                _this.props.onChange(newImages, 'remove', index);\n            }\n        };\n        _this.addImage = function (imgItem) {\n            var _this$props$files2 = _this.props.files,\n                files = _this$props$files2 === undefined ? [] : _this$props$files2;\n\n            var newImages = files.concat(imgItem);\n            if (_this.props.onChange) {\n                _this.props.onChange(newImages, 'add');\n            }\n        };\n        _this.onImageClick = function (index) {\n            if (_this.props.onImageClick) {\n                _this.props.onImageClick(index, _this.props.files);\n            }\n        };\n        _this.onFileChange = function () {\n            var fileSelectorEl = _this.fileSelectorInput;\n            if (fileSelectorEl && fileSelectorEl.files && fileSelectorEl.files.length) {\n                var files = fileSelectorEl.files;\n                var imageParsePromiseList = [];\n                for (var i = 0; i < files.length; i++) {\n                    imageParsePromiseList.push(_this.parseFile(files[i], i));\n                }\n                Promise.all(imageParsePromiseList).then(function (imageItems) {\n                    return _this.addImage(imageItems);\n                })['catch'](function (error) {\n                    if (_this.props.onFail) {\n                        _this.props.onFail(error);\n                    }\n                });\n            }\n            if (fileSelectorEl) {\n                fileSelectorEl.value = '';\n            }\n        };\n        _this.parseFile = function (file, index) {\n            return new Promise(function (resolve, reject) {\n                var reader = new FileReader();\n                reader.onload = function (e) {\n                    var dataURL = e.target.result;\n                    if (!dataURL) {\n                        reject('Fail to get the ' + index + ' image');\n                        return;\n                    }\n                    var orientation = 1;\n                    _this.getOrientation(file, function (res) {\n                        // -2: not jpeg , -1: not defined\n                        if (res > 0) {\n                            orientation = res;\n                        }\n                        resolve({\n                            url: dataURL,\n                            orientation: orientation,\n                            file: file\n                        });\n                    });\n                };\n                reader.readAsDataURL(file);\n            });\n        };\n        return _this;\n    }\n\n    _createClass(ImagePicker, [{\n        key: 'render',\n        value: function render() {\n            var _this2 = this;\n\n            var _props = this.props,\n                prefixCls = _props.prefixCls,\n                style = _props.style,\n                className = _props.className,\n                _props$files = _props.files,\n                files = _props$files === undefined ? [] : _props$files,\n                selectable = _props.selectable,\n                onAddImageClick = _props.onAddImageClick,\n                multiple = _props.multiple,\n                accept = _props.accept,\n                capture = _props.capture,\n                disableDelete = _props.disableDelete;\n\n            var imgItemList = [];\n            var count = parseInt('' + this.props.length, 10);\n            if (count <= 0) {\n                count = 4;\n            }\n            var wrapCls = classnames('' + prefixCls, className);\n            files.forEach(function (image, index) {\n                var imgStyle = {\n                    backgroundImage: 'url(\"' + image.url + '\")',\n                    transform: 'rotate(' + _this2.getRotation(image.orientation) + 'deg)'\n                };\n                var itemStyle = {};\n                imgItemList.push(React.createElement(\n                    Flex.Item,\n                    { key: 'item-' + index, style: itemStyle },\n                    React.createElement(\n                        'div',\n                        { key: index, className: prefixCls + '-item' },\n                        !disableDelete && React.createElement('div', { className: prefixCls + '-item-remove', role: 'button', 'aria-label': 'Click and Remove this image'\n                            // tslint:disable-next-line:jsx-no-multiline-js\n                            , onClick: function onClick() {\n                                _this2.removeImage(index);\n                            } }),\n                        React.createElement('div', { className: prefixCls + '-item-content', role: 'button', 'aria-label': 'Image can be clicked'\n                            // tslint:disable-next-line:jsx-no-multiline-js\n                            , onClick: function onClick() {\n                                _this2.onImageClick(index);\n                            }, style: imgStyle })\n                    )\n                ));\n            });\n            var selectEl = React.createElement(\n                Flex.Item,\n                { key: 'select' },\n                React.createElement(\n                    TouchFeedback,\n                    { activeClassName: prefixCls + '-upload-btn-active' },\n                    React.createElement(\n                        'div',\n                        { className: prefixCls + '-item ' + prefixCls + '-upload-btn', onClick: onAddImageClick, role: 'button', 'aria-label': 'Choose and add image' },\n                        React.createElement('input', { ref: function ref(input) {\n                                if (input) {\n                                    _this2.fileSelectorInput = input;\n                                }\n                            }, type: 'file', accept: accept\n                            // tslint:disable-next-line:jsx-no-multiline-js\n                            , onChange: function onChange() {\n                                _this2.onFileChange();\n                            }, multiple: multiple, capture: capture })\n                    )\n                )\n            );\n            var allEl = selectable ? imgItemList.concat([selectEl]) : imgItemList;\n            var length = allEl.length;\n            if (length !== 0 && length % count !== 0) {\n                var blankCount = count - length % count;\n                var fillBlankEl = [];\n                for (var i = 0; i < blankCount; i++) {\n                    fillBlankEl.push(React.createElement(Flex.Item, { key: 'blank-' + i }));\n                }\n                allEl = allEl.concat(fillBlankEl);\n            }\n            var flexEl = [];\n            for (var _i = 0; _i < allEl.length / count; _i++) {\n                var rowEl = allEl.slice(_i * count, _i * count + count);\n                flexEl.push(rowEl);\n            }\n            var renderEl = flexEl.map(function (item, index) {\n                return React.createElement(\n                    Flex,\n                    { key: 'flex-' + index },\n                    item\n                );\n            });\n            return React.createElement(\n                'div',\n                { className: wrapCls, style: style },\n                React.createElement(\n                    'div',\n                    { className: prefixCls + '-list', role: 'group' },\n                    renderEl\n                )\n            );\n        }\n    }]);\n\n    return ImagePicker;\n}(React.Component);\n\nexport default ImagePicker;\n\nImagePicker.defaultProps = {\n    prefixCls: 'am-image-picker',\n    files: [],\n    onChange: noop,\n    onImageClick: noop,\n    onAddImageClick: noop,\n    onFail: noop,\n    selectable: true,\n    multiple: false,\n    accept: 'image/*',\n    length: 4,\n    disableDelete: false\n};"]},"metadata":{},"sourceType":"module"}